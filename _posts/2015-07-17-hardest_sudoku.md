---
layout: post
title:  "Solving The Hardest Known Sudoku"
date:   2015-07-17
categories:
- math
description: Writing a sudoku solver with a theorem prover
---

![Sudoku](http://i.imgur.com/sp2BfW5.jpg)
The Guardian ran an [article](http://www.telegraph.co.uk/news/science/science-news/9359579/Worlds-hardest-sudoku-can-you-crack-it.html) several years ago about a very difficult Sudoku puzzle. In looking for a working link to the sudoku creator's website, I also found [these harder puzzles](http://www.sudokuwiki.org/Arto_Inkala_Sudoku).

I was able to solve these using Microsoft's theorem prover, z3. Essentially, you write a bunch of assertions, and the solver attempts to find a solution that satisfies all of the assertions.

In this case, I define 81 9 bit bit-vectors, one for each position in the 9x9 grid, and then assert:

* Each constant is a power of two - essentially each bit vector has one and only one bit set, encoding the numbers 1-9
* The bitwise or of a column, row or square of constants is equal to 111111111 - indicating that each number exists in that selection
* For cells with a specified value in the puzzle, that the constant is equal to the cell's value

I've posted the z3 code below, which I merely entered into the [tutorial](http://rise4fun.com/z3/tutorial/guide). I'm a novice with z3, so it's really inelegant. If I did this again, I'd use the Python interface to z3.

Using this, which passes the z3 off to some server in the cloud, the Guardian sudoku was solved in roughly a second, including latency, and the second, allegedly harder sudoku puzzle took 4 seconds.

I was originally going to use pycosat, but the second Google result for it is Schnell's sudoku example, and I didn't want to be repetitive so I didn't even click the link.

    (declare-const a00  (_ BitVec 9))
    (declare-const a01  (_ BitVec 9))
    (declare-const a02  (_ BitVec 9))
    (declare-const a03  (_ BitVec 9))
    (declare-const a04  (_ BitVec 9))
    (declare-const a05  (_ BitVec 9))
    (declare-const a06  (_ BitVec 9))
    (declare-const a07  (_ BitVec 9))
    (declare-const a08  (_ BitVec 9))
    (declare-const a10  (_ BitVec 9))
    (declare-const a11  (_ BitVec 9))
    (declare-const a12  (_ BitVec 9))
    (declare-const a13  (_ BitVec 9))
    (declare-const a14  (_ BitVec 9))
    (declare-const a15  (_ BitVec 9))
    (declare-const a16  (_ BitVec 9))
    (declare-const a17  (_ BitVec 9))
    (declare-const a18  (_ BitVec 9))
    (declare-const a20  (_ BitVec 9))
    (declare-const a21  (_ BitVec 9))
    (declare-const a22  (_ BitVec 9))
    (declare-const a23  (_ BitVec 9))
    (declare-const a24  (_ BitVec 9))
    (declare-const a25  (_ BitVec 9))
    (declare-const a26  (_ BitVec 9))
    (declare-const a27  (_ BitVec 9))
    (declare-const a28  (_ BitVec 9))
    (declare-const a30  (_ BitVec 9))
    (declare-const a31  (_ BitVec 9))
    (declare-const a32  (_ BitVec 9))
    (declare-const a33  (_ BitVec 9))
    (declare-const a34  (_ BitVec 9))
    (declare-const a35  (_ BitVec 9))
    (declare-const a36  (_ BitVec 9))
    (declare-const a37  (_ BitVec 9))
    (declare-const a38  (_ BitVec 9))
    (declare-const a40  (_ BitVec 9))
    (declare-const a41  (_ BitVec 9))
    (declare-const a42  (_ BitVec 9))
    (declare-const a43  (_ BitVec 9))
    (declare-const a44  (_ BitVec 9))
    (declare-const a45  (_ BitVec 9))
    (declare-const a46  (_ BitVec 9))
    (declare-const a47  (_ BitVec 9))
    (declare-const a48  (_ BitVec 9))
    (declare-const a50  (_ BitVec 9))
    (declare-const a51  (_ BitVec 9))
    (declare-const a52  (_ BitVec 9))
    (declare-const a53  (_ BitVec 9))
    (declare-const a54  (_ BitVec 9))
    (declare-const a55  (_ BitVec 9))
    (declare-const a56  (_ BitVec 9))
    (declare-const a57  (_ BitVec 9))
    (declare-const a58  (_ BitVec 9))
    (declare-const a60  (_ BitVec 9))
    (declare-const a61  (_ BitVec 9))
    (declare-const a62  (_ BitVec 9))
    (declare-const a63  (_ BitVec 9))
    (declare-const a64  (_ BitVec 9))
    (declare-const a65  (_ BitVec 9))
    (declare-const a66  (_ BitVec 9))
    (declare-const a67  (_ BitVec 9))
    (declare-const a68  (_ BitVec 9))
    (declare-const a70  (_ BitVec 9))
    (declare-const a71  (_ BitVec 9))
    (declare-const a72  (_ BitVec 9))
    (declare-const a73  (_ BitVec 9))
    (declare-const a74  (_ BitVec 9))
    (declare-const a75  (_ BitVec 9))
    (declare-const a76  (_ BitVec 9))
    (declare-const a77  (_ BitVec 9))
    (declare-const a78  (_ BitVec 9))
    (declare-const a80  (_ BitVec 9))
    (declare-const a81  (_ BitVec 9))
    (declare-const a82  (_ BitVec 9))
    (declare-const a83  (_ BitVec 9))
    (declare-const a84  (_ BitVec 9))
    (declare-const a85  (_ BitVec 9))
    (declare-const a86  (_ BitVec 9))
    (declare-const a87  (_ BitVec 9))
    (declare-const a88  (_ BitVec 9))
    (define-fun is-power-of-two ((x (_ BitVec 9))) Bool (= #b000000000 (bvand x (bvsub x #b000000001))))
    (assert (is-power-of-two a00))
    (assert (is-power-of-two a01))
    (assert (is-power-of-two a02))
    (assert (is-power-of-two a03))
    (assert (is-power-of-two a04))
    (assert (is-power-of-two a05))
    (assert (is-power-of-two a06))
    (assert (is-power-of-two a07))
    (assert (is-power-of-two a08))
    (assert (is-power-of-two a10))
    (assert (is-power-of-two a11))
    (assert (is-power-of-two a12))
    (assert (is-power-of-two a13))
    (assert (is-power-of-two a14))
    (assert (is-power-of-two a15))
    (assert (is-power-of-two a16))
    (assert (is-power-of-two a17))
    (assert (is-power-of-two a18))
    (assert (is-power-of-two a20))
    (assert (is-power-of-two a21))
    (assert (is-power-of-two a22))
    (assert (is-power-of-two a23))
    (assert (is-power-of-two a24))
    (assert (is-power-of-two a25))
    (assert (is-power-of-two a26))
    (assert (is-power-of-two a27))
    (assert (is-power-of-two a28))
    (assert (is-power-of-two a30))
    (assert (is-power-of-two a31))
    (assert (is-power-of-two a32))
    (assert (is-power-of-two a33))
    (assert (is-power-of-two a34))
    (assert (is-power-of-two a35))
    (assert (is-power-of-two a36))
    (assert (is-power-of-two a37))
    (assert (is-power-of-two a38))
    (assert (is-power-of-two a40))
    (assert (is-power-of-two a41))
    (assert (is-power-of-two a42))
    (assert (is-power-of-two a43))
    (assert (is-power-of-two a44))
    (assert (is-power-of-two a45))
    (assert (is-power-of-two a46))
    (assert (is-power-of-two a47))
    (assert (is-power-of-two a48))
    (assert (is-power-of-two a50))
    (assert (is-power-of-two a51))
    (assert (is-power-of-two a52))
    (assert (is-power-of-two a53))
    (assert (is-power-of-two a54))
    (assert (is-power-of-two a55))
    (assert (is-power-of-two a56))
    (assert (is-power-of-two a57))
    (assert (is-power-of-two a58))
    (assert (is-power-of-two a60))
    (assert (is-power-of-two a61))
    (assert (is-power-of-two a62))
    (assert (is-power-of-two a63))
    (assert (is-power-of-two a64))
    (assert (is-power-of-two a65))
    (assert (is-power-of-two a66))
    (assert (is-power-of-two a67))
    (assert (is-power-of-two a68))
    (assert (is-power-of-two a70))
    (assert (is-power-of-two a71))
    (assert (is-power-of-two a72))
    (assert (is-power-of-two a73))
    (assert (is-power-of-two a74))
    (assert (is-power-of-two a75))
    (assert (is-power-of-two a76))
    (assert (is-power-of-two a77))
    (assert (is-power-of-two a78))
    (assert (is-power-of-two a80))
    (assert (is-power-of-two a81))
    (assert (is-power-of-two a82))
    (assert (is-power-of-two a83))
    (assert (is-power-of-two a84))
    (assert (is-power-of-two a85))
    (assert (is-power-of-two a86))
    (assert (is-power-of-two a87))
    (assert (is-power-of-two a88))
    (assert (= (bvor a00 (bvor a01 (bvor a02 (bvor a03 (bvor a04 (bvor a05 (bvor a06 (bvor a07 a08)))))))) #b111111111))
    (assert (= (bvor a10 (bvor a11 (bvor a12 (bvor a13 (bvor a14 (bvor a15 (bvor a16 (bvor a17 a18)))))))) #b111111111))
    (assert (= (bvor a20 (bvor a21 (bvor a22 (bvor a23 (bvor a24 (bvor a25 (bvor a26 (bvor a27 a28)))))))) #b111111111))
    (assert (= (bvor a30 (bvor a31 (bvor a32 (bvor a33 (bvor a34 (bvor a35 (bvor a36 (bvor a37 a38)))))))) #b111111111))
    (assert (= (bvor a40 (bvor a41 (bvor a42 (bvor a43 (bvor a44 (bvor a45 (bvor a46 (bvor a47 a48)))))))) #b111111111))
    (assert (= (bvor a50 (bvor a51 (bvor a52 (bvor a53 (bvor a54 (bvor a55 (bvor a56 (bvor a57 a58)))))))) #b111111111))
    (assert (= (bvor a60 (bvor a61 (bvor a62 (bvor a63 (bvor a64 (bvor a65 (bvor a66 (bvor a67 a68)))))))) #b111111111))
    (assert (= (bvor a70 (bvor a71 (bvor a72 (bvor a73 (bvor a74 (bvor a75 (bvor a76 (bvor a77 a78)))))))) #b111111111))
    (assert (= (bvor a80 (bvor a81 (bvor a82 (bvor a83 (bvor a84 (bvor a85 (bvor a86 (bvor a87 a88)))))))) #b111111111))
    (assert (= (bvor a00 (bvor a10 (bvor a20 (bvor a30 (bvor a40 (bvor a50 (bvor a60 (bvor a70 a80)))))))) #b111111111))
    (assert (= (bvor a01 (bvor a11 (bvor a21 (bvor a31 (bvor a41 (bvor a51 (bvor a61 (bvor a71 a81)))))))) #b111111111))
    (assert (= (bvor a02 (bvor a12 (bvor a22 (bvor a32 (bvor a42 (bvor a52 (bvor a62 (bvor a72 a82)))))))) #b111111111))
    (assert (= (bvor a03 (bvor a13 (bvor a23 (bvor a33 (bvor a43 (bvor a53 (bvor a63 (bvor a73 a83)))))))) #b111111111))
    (assert (= (bvor a04 (bvor a14 (bvor a24 (bvor a34 (bvor a44 (bvor a54 (bvor a64 (bvor a74 a84)))))))) #b111111111))
    (assert (= (bvor a05 (bvor a15 (bvor a25 (bvor a35 (bvor a45 (bvor a55 (bvor a65 (bvor a75 a85)))))))) #b111111111))
    (assert (= (bvor a06 (bvor a16 (bvor a26 (bvor a36 (bvor a46 (bvor a56 (bvor a66 (bvor a76 a86)))))))) #b111111111))
    (assert (= (bvor a07 (bvor a17 (bvor a27 (bvor a37 (bvor a47 (bvor a57 (bvor a67 (bvor a77 a87)))))))) #b111111111))
    (assert (= (bvor a08 (bvor a18 (bvor a28 (bvor a38 (bvor a48 (bvor a58 (bvor a68 (bvor a78 a88)))))))) #b111111111))
    (assert (= (bvor a00 (bvor a01 (bvor a02 (bvor a10 (bvor a11 (bvor a12 (bvor a20 (bvor a21 a22)))))))) #b111111111))
    (assert (= (bvor a03 (bvor a04 (bvor a05 (bvor a13 (bvor a14 (bvor a15 (bvor a23 (bvor a24 a25)))))))) #b111111111))
    (assert (= (bvor a06 (bvor a07 (bvor a08 (bvor a16 (bvor a17 (bvor a18 (bvor a26 (bvor a27 a28)))))))) #b111111111))
    (assert (= (bvor a30 (bvor a31 (bvor a32 (bvor a40 (bvor a41 (bvor a42 (bvor a50 (bvor a51 a52)))))))) #b111111111))
    (assert (= (bvor a33 (bvor a34 (bvor a35 (bvor a43 (bvor a44 (bvor a45 (bvor a53 (bvor a54 a55)))))))) #b111111111))
    (assert (= (bvor a36 (bvor a37 (bvor a38 (bvor a46 (bvor a47 (bvor a48 (bvor a56 (bvor a57 a58)))))))) #b111111111))
    (assert (= (bvor a60 (bvor a61 (bvor a62 (bvor a70 (bvor a71 (bvor a72 (bvor a80 (bvor a81 a82)))))))) #b111111111))
    (assert (= (bvor a63 (bvor a64 (bvor a65 (bvor a73 (bvor a74 (bvor a75 (bvor a83 (bvor a84 a85)))))))) #b111111111))
    (assert (= (bvor a66 (bvor a67 (bvor a68 (bvor a76 (bvor a77 (bvor a78 (bvor a86 (bvor a87 a88)))))))) #b111111111))
    (assert (= a00 #b000000010))
    (assert (= a12 #b001000000))
    (assert (= a21 #b000000100))
    (assert (= a31 #b000010000))
    (assert (= a13 #b000001000))
    (assert (= a24 #b000000001))
    (assert (= a26 #b010000000))
    (assert (= a35 #b000000100))
    (assert (= a44 #b000100000))
    (assert (= a45 #b000010000))
    (assert (= a46 #b000000100))
    (assert (= a53 #b100000000))
    (assert (= a57 #b001000000))
    (assert (= a62 #b100000000))
    (assert (= a67 #b000001000))
    (assert (= a68 #b000000010))
    (assert (= a72 #b000000010))
    (assert (= a73 #b000010000))
    (assert (= a77 #b100000000))
    (assert (= a81 #b000000001))
    (assert (= a86 #b000100000))
    (check-sat)
    (get-model)
